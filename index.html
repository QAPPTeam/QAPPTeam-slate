
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#index-js-and-db-js" class="toc-h1 toc-link" data-title="Index.js and db.js">Index.js and db.js</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#api-setup-code" class="toc-h2 toc-link" data-title="API setup code">API setup code</a>
                  </li>
                  <li>
                    <a href="#connecting-to-mongodb-atlas" class="toc-h2 toc-link" data-title="Connecting to Mongodb Atlas">Connecting to Mongodb Atlas</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#users" class="toc-h1 toc-link" data-title="Users">Users</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#user-routes" class="toc-h2 toc-link" data-title="User Routes">User Routes</a>
                  </li>
                  <li>
                    <a href="#researcher-model" class="toc-h2 toc-link" data-title="Researcher Model">Researcher Model</a>
                  </li>
                  <li>
                    <a href="#participant-model" class="toc-h2 toc-link" data-title="Participant Model">Participant Model</a>
                  </li>
                  <li>
                    <a href="#signup-enpoints" class="toc-h2 toc-link" data-title="Signup enpoints">Signup enpoints</a>
                  </li>
                  <li>
                    <a href="#login-endpoint" class="toc-h2 toc-link" data-title="Login endpoint">Login endpoint</a>
                  </li>
                  <li>
                    <a href="#user-update-endpoint" class="toc-h2 toc-link" data-title="User Update Endpoint">User Update Endpoint</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#studies" class="toc-h1 toc-link" data-title="Studies">Studies</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#study-routes" class="toc-h2 toc-link" data-title="Study Routes">Study Routes</a>
                  </li>
                  <li>
                    <a href="#study-model" class="toc-h2 toc-link" data-title="Study model">Study model</a>
                  </li>
                  <li>
                    <a href="#create-studies" class="toc-h2 toc-link" data-title="Create studies">Create studies</a>
                  </li>
                  <li>
                    <a href="#get-all-studies" class="toc-h2 toc-link" data-title="get all studies">get all studies</a>
                  </li>
                  <li>
                    <a href="#get-some-studies" class="toc-h2 toc-link" data-title="get some studies">get some studies</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#todo" class="toc-h1 toc-link" data-title="TODO">TODO</a>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the API documentation page.</p>

<p>This API is currently being hosted on <a href="https://research-stream.herokuapp.com/">Heroku</a> and uses MongoDB Atlas to host the databases.</p>

<p>This example API documentation page was created with <a href="https://github.com/lord/slate">Slate</a>.</p>
<h1 id='index-js-and-db-js'>Index.js and db.js</h1><h2 id='api-setup-code'>API setup code</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">urlencodedParser</span> <span class="o">=</span> <span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">false</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express-session'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./db'</span><span class="p">).</span><span class="nx">connect</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">urlencodedParser</span><span class="p">);</span>

<span class="c1">//app.use(express.static('demo'));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span>
  <span class="na">secret</span><span class="p">:</span> <span class="s1">'lets go'</span><span class="p">,</span>
  <span class="na">cookie</span><span class="p">:</span> <span class="p">{</span><span class="na">path</span> <span class="p">:</span> <span class="s1">'/'</span><span class="p">},</span>
  <span class="na">resave</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">saveUninitialized</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="c1">//TODO save sessions to db</span>
<span class="p">}));</span>

<span class="c1">//routes for studies researcher and participant</span>
<span class="kr">const</span> <span class="nx">Study</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./routes/study.route'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./routes/user.route'</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/user'</span><span class="p">,</span> <span class="nx">User</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/study'</span><span class="p">,</span> <span class="nx">Study</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'landing page'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"error connecting to db"</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"connected to db"</span><span class="p">)</span>

  <span class="p">}</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">5000</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Listening on </span><span class="p">${</span> <span class="nx">PORT</span> <span class="p">}</span><span class="s2">`</span><span class="p">));</span>
</code></pre>
<p>This is the main code that sets up the db</p>

<p>The API requires bodyParser in order to properly be able to get data for a front end webpage in a JSON format.</p>

<p>Express-session is used to create a session state for the app to be able to verify that a user is logged in, it is currently being saved to cookies, this will be changed so the ids of logged in users are saved to the database.</p>

<p>The connect function is written in a different document so other endpoints also have access to the open database connection</p>

<p>The app is initiated at the end of this function.</p>
<h2 id='connecting-to-mongodb-atlas'>Connecting to Mongodb Atlas</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">mongoose</span>

<span class="kd">let</span> <span class="nx">_db</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">get</span><span class="p">,</span>
    <span class="nx">connect</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">_db</span><span class="p">)</span> <span class="k">return</span>
  <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s2">"mongodb+srv://15lc50:W!ldcats@cluster0-mfedp.mongodb.net/test?retryWrites=true"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> 
    <span class="nx">_db</span> <span class="o">=</span> <span class="nx">client</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_db</span><span class="p">);</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">get</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">_db</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">_db</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"db not set"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>The connect function uses a url aquired from the mongodb Atlas page to connect to the database
in order to connect the ip address of the computer running this code has to be whitelisted in mongoDB Atlas. It connects useing the mongoose connect function so that mongoose schemas can be used when saveing users and studies.</p>

<p>The get function returns the database connection object for use in other functions</p>
<h1 id='users'>Users</h1><h2 id='user-routes'>User Routes</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="c1">// Require the controllers</span>
<span class="kr">const</span> <span class="nx">userController</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../controllers/user.controller'</span><span class="p">);</span>

<span class="c1">//post request to add users to database</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/registerParticipant'</span><span class="p">,</span> <span class="nx">userController</span><span class="p">.</span><span class="nx">participantCreate</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/registerResearcher'</span><span class="p">,</span> <span class="nx">userController</span><span class="p">.</span><span class="nx">researcherCreate</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="nx">userController</span><span class="p">.</span><span class="nx">userLogin</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/update'</span><span class="p">,</span> <span class="nx">userController</span><span class="p">.</span><span class="nx">userUpdate</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre>
<p>User routes, connect user routes to apporpriate user controller.</p>

<p>The User Routes incluse 2 routes to register participants and researchers, one endpoint for logging users in and one for updateing user information.</p>
<h2 id='researcher-model'>Researcher Model</h2>
<blockquote>
<p>This endpoint is used to verify the inputs when createing a researcher object to save to the database</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">ResearcherSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="p">[</span><span class="kc">true</span><span class="p">,</span> <span class="s1">'must have a name'</span><span class="p">],</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">institution</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span> <span class="c1">//check if the institution exists?</span>
    <span class="na">department</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">address</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">country</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">phonenum</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
    <span class="na">email</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span> <span class="c1">//TODO check is e mail and is unique</span>
    <span class="na">password</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="c1">//add password confirmation?</span>
    <span class="na">usertype</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span> <span class="na">match</span><span class="p">:</span><span class="sr">/researcher/</span><span class="p">}</span>
<span class="p">});</span> <span class="c1">//add better error messages</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Researcher'</span><span class="p">,</span> <span class="nx">ResearcherSchema</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>There are separate user models for researchers and participants</p>
</blockquote>

<p>The use of mongoose shemas allows for thorough verification of inputs before they are saved to the database.</p>

<table><thead>
<tr>
<th>Validation parameters</th>
<th>effect</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>The type of item, all items in this schema are strings</td>
</tr>
<tr>
<td>required</td>
<td>This input is required, all items in this schema are required</td>
</tr>
<tr>
<td>maxlength</td>
<td>The max length of a string</td>
</tr>
<tr>
<td>match</td>
<td>item must max the regex statement</td>
</tr>
</tbody></table>

<p>For more information about mongoose schemas <a href="https://mongoosejs.com/docs/schematypes.html">go here</a>.</p>

<p>Items created useing this model are saved to the User collection in the database</p>
<h2 id='participant-model'>Participant Model</h2>
<blockquote>
<p>This endpoint is used to verify the inputs when createing a researcher object to save to the database</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">ParticipantSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">age</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">max</span><span class="p">:</span><span class="mi">100</span><span class="p">},</span>
    <span class="na">city</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">phonenum</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
    <span class="na">email</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>  <span class="c1">//TODO check e-mail is unique</span>
    <span class="na">password</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlenght</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="na">usertype</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">match</span><span class="p">:</span><span class="sr">/participant/</span><span class="p">},</span>
    <span class="na">studies</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">Array</span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Researcher'</span><span class="p">,</span> <span class="nx">ResearcherSchema</span><span class="p">,</span> <span class="s2">"User"</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>There are separate user models for researchers and participants</p>
</blockquote>

<p>The User model requires fewer inputs than the Researcher model (no department or institution)</p>

<p>&#39;Studies&#39; array will be filled with study objects with specific times the user has signed up for, the calander endpoint is not implemented yet.</p>

<p>The use of mongoose shemas allows for thorough verification of inputs before they are saved to the database.</p>

<table><thead>
<tr>
<th>Validation parameters</th>
<th>effect</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>The type of item, the three kinds of items in this schema are strings, numbers, and arrays</td>
</tr>
<tr>
<td>required</td>
<td>This input is required, all items in this schema are required</td>
</tr>
<tr>
<td>maxlength</td>
<td>The max length of a string</td>
</tr>
<tr>
<td>match</td>
<td>item must max the regex statement</td>
</tr>
</tbody></table>

<p>participant model is always saved to the User collection</p>

<p>For more information about mongoose schemas <a href="https://mongoosejs.com/docs/schematypes.html">go here</a>.</p>
<h2 id='signup-enpoints'>Signup enpoints</h2>
<blockquote>
<p>require the participant and researcher models from above and bcrypt to encrypt passwords before they are saved to the database</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Participant</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/participant.model'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Researcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/researcher.model'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'bcrypt'</span><span class="p">);</span>

<span class="c1">//register user endpoint</span>
<span class="c1">//register user endpoint</span>
<span class="kd">function</span> <span class="nx">participantCreate</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span>
    <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">pass</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="kd">let</span> <span class="nx">participant</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Participant</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="na">age</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">age</span><span class="p">,</span>
            <span class="na">city</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">city</span><span class="p">,</span>
            <span class="na">phonenum</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">phonenum</span><span class="p">,</span>
            <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>  <span class="c1">//make e mails and phone numbers unique</span>
            <span class="na">password</span><span class="p">:</span> <span class="nx">hash</span><span class="p">,</span>
        <span class="p">},</span><span class="c1">//dont know what the contraints are for the parameters, will add later</span>
        <span class="c1">//user input not sanatised?</span>
    <span class="p">)</span>
        <span class="nx">participant</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">participant</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>
<span class="p">});</span>
<span class="p">};</span>

<span class="c1">//register researcher endpoint</span>
<span class="kd">function</span> <span class="nx">researcherCreate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span>
    <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">pass</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">let</span> <span class="nx">researcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Researcher</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                <span class="na">institution</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">institution</span><span class="p">,</span>
                <span class="na">department</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">department</span><span class="p">,</span>
                <span class="na">address</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
                <span class="na">country</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">country</span><span class="p">,</span>
                <span class="na">phonenum</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">phonenum</span><span class="p">,</span>
                <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="c1">//make emails and phone numbers unique</span>
                <span class="na">password</span><span class="p">:</span> <span class="nx">hash</span><span class="p">,</span>
                <span class="na">usertype</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">usertype</span>
            <span class="p">},</span><span class="c1">//dont know what the contraints are for the parameters, will check later</span>
            <span class="c1">//user input not sanatised</span>
        <span class="p">)</span>
        <span class="nx">researcher</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">researcher</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Signup endpoints are different for participants and researcher</p>
</blockquote>

<p>The sighup endpoint creates a user ojebct useing the schmeas listed above, hashes the password the user typed in, and saves the user data to the database.</p>

<p>The two signup endpoints are acces via the routes </p>

<ul>
<li>https://research-stream.herokuapp.com/user/registerResearcher </li>
<li>https://research-stream.herokuapp.com/user/registerParticipant</li>
</ul>
<h2 id='login-endpoint'>Login endpoint</h2>
<blockquote>
<p>requires db to access database and bcrypt the compare hashed and unhashed passwords</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kd">function</span> <span class="nx">userLogin</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">().</span><span class="nx">collection</span><span class="p">(</span><span class="s2">"User"</span><span class="p">).</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">email</span> <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userId</span><span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"User is already logged in"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">"Username or password is incorrect"</span><span class="p">,</span><span class="mi">406</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"Logged in"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"Username or password is incorrect"</span><span class="p">,</span><span class="mi">406</span><span class="p">);</span>
            <span class="p">};</span>
            <span class="p">});</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userId</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
        <span class="p">}</span>
        <span class="p">});</span>

<span class="p">}</span>
</code></pre>
<p>The User is identified by a unique email and password
The login endpoint saves a user&#39;s unique ID to a session state to that it can be checked before the user accesses other checkpoints.</p>

<p>Login is accessed via the endpoint</p>

<ul>
<li>https://research-stream.herokuapp.com/user/login</li>
</ul>
<h2 id='user-update-endpoint'>User Update Endpoint</h2><pre class="highlight javascript tab-javascript"><code><span class="kd">function</span> <span class="nx">userUpdate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
    <span class="nx">user</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">().</span><span class="nx">collection</span><span class="p">(</span><span class="s2">"User"</span><span class="p">).</span><span class="nx">findOne</span><span class="p">({</span><span class="na">_id</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userId</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">isEmpy</span><span class="p">(</span><span class="nx">user</span><span class="p">)){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"This user no longer exists"</span><span class="p">,</span><span class="mi">406</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">usertype</span> <span class="o">=</span> <span class="s2">"researcher"</span><span class="p">){</span>
        <span class="nx">researcherCreate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
        <span class="nx">participantCreate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<p>This enpoint updates user information. It does this by calling the create user endpoint which validates input and, if an object with the same id already exists, performes and update action instead of a create action (mongoose takes care of this useing the user.save())</p>
<h1 id='studies'>Studies</h1><h2 id='study-routes'>Study Routes</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">requiresLogin</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userId</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">'You must be logged in to view this page.'</span><span class="p">,</span> <span class="mi">401</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="c1">// Require the controllers</span>
<span class="kr">const</span> <span class="nx">studyController</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../controllers/study.controller'</span><span class="p">);</span>

<span class="c1">// post endpoint to add study to database</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/create'</span><span class="p">,</span> <span class="nx">requiresLogin</span><span class="p">,</span> <span class="nx">studyController</span><span class="p">.</span><span class="nx">studyCreate</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/get'</span><span class="p">,</span> <span class="nx">requiresLogin</span><span class="p">,</span> <span class="nx">studyController</span><span class="p">.</span><span class="nx">studyGet</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/:name'</span><span class="p">,</span> <span class="nx">requiresLogin</span><span class="p">,</span> <span class="nx">studyController</span><span class="p">.</span><span class="nx">getName</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/:location'</span><span class="p">,</span> <span class="nx">requiresLogin</span><span class="p">,</span> <span class="nx">studyController</span><span class="p">.</span><span class="nx">getLocation</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/:lab'</span><span class="p">,</span> <span class="nx">requiresLogin</span><span class="p">,</span> <span class="nx">studyController</span><span class="p">.</span><span class="nx">getLab</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/:researcher'</span><span class="p">,</span> <span class="nx">requiresLogin</span><span class="p">,</span> <span class="nx">studyController</span><span class="p">.</span><span class="nx">getResearcher</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre>
<p>Connect Study routes to apporpriate study controller</p>

<p>the function requiresLogin runs before the study endpoints are called to ensure that a user is logged in</p>
<h2 id='study-model'>Study model</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">StudySchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="p">[</span><span class="kc">true</span><span class="p">,</span> <span class="s1">'must enter a name'</span><span class="p">],</span> <span class="na">maxlength</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">details</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span><span class="mi">300</span><span class="p">},</span>
    <span class="na">lab</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span><span class="mi">100</span><span class="p">},</span>
    <span class="na">contactInfo</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="na">location</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span><span class="mi">100</span><span class="p">},</span>
    <span class="na">compensation</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="na">criteria</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span><span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="na">expectation</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span><span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="na">email</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span><span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">maxlength</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="na">researcher</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span><span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Study'</span><span class="p">,</span> <span class="nx">StudySchema</span><span class="p">,</span> <span class="s2">"Study"</span><span class="p">);</span>
</code></pre>
<p>Model for studies, based on provided schema</p>

<table><thead>
<tr>
<th>Validation parameters</th>
<th>effect</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>The type of item, the three kinds of items in this schema are strings and numbers</td>
</tr>
<tr>
<td>required</td>
<td>This input is required, all items in this schema are required</td>
</tr>
<tr>
<td>maxlength</td>
<td>The max length of a string</td>
</tr>
<tr>
<td>match</td>
<td>item must max the regex statement</td>
</tr>
</tbody></table>

<p>For more information about mongoose schemas <a href="https://mongoosejs.com/docs/schematypes.html">go here</a>.</p>
<h2 id='create-studies'>Create studies</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Study</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/study.model'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">studyCreate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">study</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Study</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="na">details</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">details</span><span class="p">,</span>
            <span class="na">lab</span><span class="p">:</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lab</span><span class="p">,</span>
            <span class="na">contactInfo</span><span class="p">:</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">contactInfo</span><span class="p">,</span>
            <span class="na">location</span><span class="p">:</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>
            <span class="na">compensation</span><span class="p">:</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">compensation</span><span class="p">,</span>
            <span class="na">criteria</span><span class="p">:</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">criteria</span><span class="p">,</span>
            <span class="na">expectation</span><span class="p">:</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">expectation</span><span class="p">,</span>
            <span class="na">email</span><span class="p">:</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
            <span class="na">researcher</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">researcher</span><span class="p">,</span> <span class="c1">//TODO change this to automatically get researcher's name from login information</span>
        <span class="p">},</span><span class="c1">//add error if user is not a researcher</span>
        <span class="c1">//user input not sanatised</span>
    <span class="p">)</span>
        <span class="nx">study</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"researcher created successfully"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>
<span class="p">};</span>
</code></pre>
<p>Creates a study according to the <a href="#study-model">study model</a> and saves it to the studies collection of the database.</p>

<p>This endpoint can be accessed through</p>

<ul>
<li>https://research-stream.herokuapp.com/study/get</li>
</ul>
<h2 id='get-all-studies'>get all studies</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../db'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">studyGet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">().</span><span class="nx">db</span><span class="p">(</span><span class="s2">"ResearchDB"</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'Studies'</span><span class="p">).</span><span class="nx">find</span><span class="p">({}).</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre>
<blockquote>
<p>This code return a json like this</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"details"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some details"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"lab"</span><span class="p">:</span><span class="w">  </span><span class="s2">"a place"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"contactInfo"</span><span class="p">:</span><span class="w">  </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location"</span><span class="p">:</span><span class="w">  </span><span class="s2">"a city"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"compensation"</span><span class="p">:</span><span class="w">  </span><span class="s2">"some form of compensation"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"criteria"</span><span class="p">:</span><span class="w">  </span><span class="s2">"study entrant criteria"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expectation"</span><span class="p">:</span><span class="w">  </span><span class="s2">"expectation"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"email"</span><span class="p">:</span><span class="w">  </span><span class="s2">"somebody@somewhere.com"</span><span class="w"> </span><span class="p">,</span><span class="w">
    </span><span class="s2">"researcher"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a persons name"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This endpoint return a list of all studies.
The endpoints for returning only some studies depending on certain attributes</p>

<p>accessible by</p>

<ul>
<li>https://research-stream.herokuapp.com/study/get</li>
</ul>
<h2 id='get-some-studies'>get some studies</h2><pre class="highlight javascript tab-javascript"><code>
<span class="c1">//name</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">().</span><span class="nx">collection</span><span class="p">(</span><span class="s2">"Study"</span><span class="p">).</span><span class="nx">find</span><span class="p">({</span><span class="na">name</span><span class="p">:</span><span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">.</span><span class="nx">id</span><span class="p">}).</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">" studies have this name\n"</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">//lists the number of studies with the specified name and returns studies with a specific name</span>
<span class="p">};</span>

<span class="c1">//location</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getLocation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">().</span><span class="nx">collection</span><span class="p">(</span><span class="s2">"Study"</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'Studies'</span><span class="p">).</span><span class="nx">find</span><span class="p">({</span><span class="na">location</span><span class="p">:</span><span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">.</span><span class="nx">location</span><span class="p">}).</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">" studies in this location\n"</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">//lists the number of studies with the specified locaation and returns list of studies with this name</span>
<span class="p">};</span>

<span class="c1">//lab</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getLab</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">().</span><span class="nx">collection</span><span class="p">(</span><span class="s2">"Study"</span><span class="p">).</span><span class="nx">db</span><span class="p">(</span><span class="s2">"ResearchDB"</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'Studies'</span><span class="p">).</span><span class="nx">find</span><span class="p">({</span><span class="na">lab</span><span class="p">:</span><span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">.</span><span class="nx">lab</span><span class="p">}).</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">" studies executed in this lab\n"</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">//lists the number of studies with the specified location and returns list of studies with this name</span>
<span class="p">};</span>

<span class="c1">//researcher</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getResearcher</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">().</span><span class="nx">collection</span><span class="p">(</span><span class="s2">"Study"</span><span class="p">).</span><span class="nx">db</span><span class="p">(</span><span class="s2">"ResearchDB"</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'Studies'</span><span class="p">).</span><span class="nx">find</span><span class="p">({</span><span class="na">researcher</span><span class="p">:</span><span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">.</span><span class="nx">researcher</span><span class="p">}).</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">" studies conducted by "</span> <span class="o">+</span> <span class="nx">researcher</span> <span class="o">+</span> <span class="s2">"\n"</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="c1">//lists the number of studies with the specified locaation and returns list of studies with this name</span>
<span class="p">};</span>
</code></pre>
<p>These endpoints return studies by name, location, lab, and researcher.
These studies are returned in a json containging an array of studies in the same format at the endpoint above and returns all studies.</p>
<h1 id='todo'>TODO</h1>
<ol>
<li>Messageing endpoint documentation</li>
<li>Endpoint to get only some studies</li>
<li>calander intergration</li>
<li>fix error messages to be more consistent and helpful</li>
</ol>
<h1 id='errors'>Errors</h1>
<aside class="notice">
useful error messages are not fully implemented, most errors do not currently return the correct error code
</aside>

<p>API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request -- Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized -- Your API key is wrong.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found -- The specified user or study could not be found.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
</tr>
<tr>
<td>406</td>
<td>Invalid Input</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error -- We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable -- We&#39;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
